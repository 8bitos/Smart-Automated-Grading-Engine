Berikut adalah rancangan database lengkap untuk sistem **SAGE** Anda dalam format teks yang rapi. Rancangan ini disusun berdasarkan dokumen teknis Anda untuk memastikan integritas data antara Guru, Siswa, Kelas, dan materi untuk proses **RAG**.

### Rancangan Database SAGE (Format .txt)

```text
=====================================================
SISTEM DATABASE SAGE (Smart Automated Grading Engine)
=====================================================

1. TABEL: users (Data Induk Pengguna)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1174]
- [cite_start]nama_lengkap    : VARCHAR(255) [cite: 1178]
- [cite_start]email           : VARCHAR(255) (Unique) [cite: 1181]
- [cite_start]password        : VARCHAR(255) (Hashed) [cite: 1185]
- [cite_start]peran           : ENUM ('teacher', 'student') [cite: 1189]
- nomor_identitas : VARCHAR(50) (NIP/NIS)
- [cite_start]created_at      : TIMESTAMP [cite: 1187]

2. TABEL: classes (Manajemen Ruang Kelas)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1176]
- [cite_start]guru_id         : UUID (Foreign Key -> users.id) [cite: 1183]
- [cite_start]nama_kelas      : VARCHAR(255) [cite: 1180]
- [cite_start]deskripsi       : TEXT [cite: 1110]
- [cite_start]created_at      : TIMESTAMP [cite: 1193]

3. TABEL: class_members (Relasi Pendaftaran Siswa)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1211]
- [cite_start]kelas_id        : UUID (Foreign Key -> classes.id) [cite: 1212]
- [cite_start]siswa_id        : UUID (Foreign Key -> users.id) [cite: 1212]
- [cite_start]joined_at       : TIMESTAMP [cite: 1212]

4. TABEL: materials (Basis Pengetahuan RAG)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1256]
- [cite_start]kelas_id        : UUID (Foreign Key -> classes.id) [cite: 1268]
- [cite_start]pengunggah_id   : UUID (Foreign Key -> users.id) [cite: 1122]
- [cite_start]judul           : VARCHAR(255) [cite: 1263]
- [cite_start]isi_materi      : TEXT (Konten teks untuk embedding AI) [cite: 1264]
- [cite_start]file_url        : TEXT (Link PDF/Dokumen asli) [cite: 1270]
- [cite_start]created_at      : TIMESTAMP [cite: 1277]

5. TABEL: essay_questions (Bank Soal)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1292]
- [cite_start]materi_id       : UUID (Foreign Key -> materials.id) [cite: 1296]
- [cite_start]teks_soal       : TEXT [cite: 1299]
- [cite_start]level_kognitif  : ENUM ('C1', 'C2', 'C3', 'C4') [cite: 679]
- [cite_start]kunci_jawaban   : TEXT (Referensi utama RAG) [cite: 1303]

6. TABEL: rubrics (Kriteria Penilaian Analitik)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1356]
- [cite_start]soal_id         : UUID (Foreign Key -> essay_questions.id) [cite: 1359]
- [cite_start]nama_aspek      : VARCHAR(255) (Misal: Relevansi, Argumen) [cite: 1365]
- [cite_start]deskripsi       : TEXT [cite: 1367]
- [cite_start]bobot           : FLOAT [cite: 1024]

7. TABEL: essay_submissions (Jawaban Siswa)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1380]
- [cite_start]soal_id         : UUID (Foreign Key -> essay_questions.id) [cite: 1384]
- [cite_start]siswa_id        : UUID (Foreign Key -> users.id) [cite: 1388]
- [cite_start]teks_jawaban    : TEXT [cite: 1392]
- [cite_start]submitted_at    : TIMESTAMP [cite: 1408]

8. TABEL: ai_results (Hasil Generasi Gemini)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1062]
- [cite_start]submission_id   : UUID (Foreign Key -> essay_submissions.id) [cite: 1070]
- [cite_start]skor_ai         : FLOAT [cite: 1078]
- [cite_start]umpan_balik_ai  : TEXT [cite: 1086]
- [cite_start]logs_rag        : TEXT (Konteks materi yang ditarik AI) [cite: 122]
- [cite_start]generated_at    : TIMESTAMP [cite: 1094]

9. TABEL: teacher_reviews (Validasi Akhir Guru)
-----------------------------------------------------
- [cite_start]id              : UUID (Primary Key) [cite: 1064]
- [cite_start]submission_id   : UUID (Foreign Key -> essay_submissions.id) [cite: 1072]
- [cite_start]skor_final      : FLOAT [cite: 1080]
- [cite_start]catatan_guru    : TEXT [cite: 1088]
- [cite_start]reviewed_at     : TIMESTAMP [cite: 1096]

```

---

### Penjelasan Lengkap Relasi

1. **Relasi Guru ke Kelas (1:M)**
Satu akun guru dapat membuat dan mengelola banyak kelas berbeda (misal: Sejarah XI-A, Sejarah XI-B). Di dalam tabel `classes`, kolom `guru_id` memastikan bahwa hanya guru pembuat yang memiliki akses administratif untuk mengelola materi dan soal.


2. **Relasi Siswa ke Kelas (M:M)**
Siswa dan Kelas dihubungkan melalui tabel `class_members`. Hal ini memungkinkan seorang siswa untuk terdaftar di banyak mata pelajaran sekaligus, dan satu kelas dapat menampung puluhan siswa.


3. **Relasi Materi ke Kelas (1:M)**
Setiap materi (seperti modul sejarah) secara spesifik dimiliki oleh satu kelas tertentu. Kolom `pengunggah_id` pada tabel `materials` berfungsi untuk melacak guru mana yang mengunggah dokumen tersebut untuk keperluan akuntabilitas.


4. **Relasi Soal ke Materi (1:M)**
Soal esai dibangun berdasarkan materi pembelajaran tertentu. Hal ini krusial untuk fitur **RAG** Anda, karena saat siswa menjawab soal, sistem akan menggunakan relasi ini untuk mencari referensi hanya pada materi yang relevan dengan soal tersebut.


5. **Relasi Hasil AI dan Review Guru ke Jawaban (1:1)**
Setiap satu jawaban siswa (`submission`) hanya akan memiliki satu hasil penilaian otomatis dari Gemini dan satu hasil validasi akhir dari guru. Pemisahan ini memungkinkan guru untuk membandingkan skor AI dengan penilaian manual mereka untuk memastikan keadilan bagi siswa.

